<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Results</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div id="progress-container" style="display:none">
        <div id="progress-bar"></div>
    </div>
    <a href="{{ url_for('upload') }}">Back</a>
    {% for r in results %}
    <h3>{{ r.filename }} - {{ r.job_id }}</h3>
    <pre id="md{{ loop.index }}">{{ r.output }}</pre>
    <button onclick="copy({{ loop.index }})">Copy Markdown</button>
    <button onclick="download({{ loop.index }})">Download Markdown</button>
    <button onclick="exportJSON({{ loop.index }})">Export as JSON</button>
    <br>
    <textarea id="json{{ loop.index }}" rows="10" cols="80" readonly style="display:none"></textarea><br>
    <button id="copyJson{{ loop.index }}" onclick="copyJson({{ loop.index }})" style="display:none">Copy JSON</button>
    <button id="downloadJson{{ loop.index }}" onclick="downloadJson({{ loop.index }})" style="display:none">Download JSON</button>
    <form method="post" class="retry-form" action="{{ url_for('retry', filename=r.filename) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <textarea name="prompt" rows="6" cols="80">{{ r.prompt }}</textarea><br>
        <button type="submit">Edit & Retry</button>
    </form>
    <div>{{ r.html | safe }}</div>
    <hr>
    {% endfor %}
<script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>
